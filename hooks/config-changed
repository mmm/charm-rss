#!/bin/bash
set -eux

[ -f lib/netflix/utils.sh ] && . lib/netflix/utils.sh 
#[ -f lib/netflix/rss-utils.sh ] && . lib/netflix/rss-utils.sh 

build_rss() {
  local rss_build_dir=$1
  pull_fresh_source https://github.com/Netflix/recipes-rss.git $rss_build_dir
  gradle_build $rss_build_dir
}
[ "$(config-get build_rss)" == "True" ] && build_rss $(config-get rss_build_dir)

install_rss() {
  local build_dir="$(config-get rss_build_dir)/rss-middletier/build/libs/"
  local jar_file=$(find $build_dir -name "*SNAPSHOT.jar")
  local rss_jar_dir="$(config-get rss_build_dir)/rss-middletier.jar"
  mkdir -p $rss_jar_dir
  [ -f "$jar_file" ] && ( cd $rss_jar_dir && jar xvf $jar_file )
}
#TODO add other ways of getting a war file besides building
[ "$(config-get build_rss)" == "True" ] && install_rss

# install rss upstart job

exit 0
